import pandas as pd 
import xgboost as xgb
import pyarrow as pa
import pyarrow.parquet as pq

import gc

# Load only the column names from the training data from 15 to 21
columnas = ["auction_age","auction_bidfloor","auction_time","creative_height","creative_width","timezone_offset","dia_semana","hora","minuto","action_categorical_0_11b7af3d","action_categorical_0_604d011f","action_categorical_0_6b5513a4","action_categorical_0_7f02cacc","action_categorical_0_9915ffee","action_categorical_0_c186959e","action_categorical_0_c202ab08","action_categorical_0_c2e4f717","action_categorical_0_e350c7c7","action_categorical_1_0d132da2","action_categorical_1_11fe6f26","action_categorical_1_3074db21","action_categorical_1_62f19448","action_categorical_1_6d1ca31b","action_categorical_1_ac0f362d","action_categorical_1_d9eb38d8","action_categorical_1_dc24b79b","action_categorical_1_df5eb4dc","action_categorical_1_e220fce9","action_categorical_1_e709bbc0","action_categorical_1_f4cd321d","action_categorical_1_f71d2f9b","action_categorical_5_6bc0e29c","action_categorical_5_79ceee49","action_categorical_6_4f7786a1","action_categorical_6_59638795","action_categorical_7_31b31f57","action_categorical_7_e2538fca","auction_categorical_1_1be29569","auction_categorical_1_714a9147","auction_categorical_1_ababfacb","auction_categorical_10_d6496210","auction_categorical_10_fa9faac9","auction_categorical_2_d215b4a2","auction_categorical_4_7db9dc73","auction_categorical_4_ef64698f","auction_categorical_5_c99696ad","auction_categorical_5_ec8edf0b","auction_categorical_8_198c733d","auction_categorical_8_62d6343e","auction_categorical_8_70114894","auction_categorical_8_856f1b75","auction_categorical_8_9685087a","auction_categorical_8_97fd48df","auction_categorical_8_d7a49a2e","auction_categorical_8_e361d5bc","auction_categorical_8_ee36ba80","auction_categorical_8_fe917183","creative_categorical_1_35fcfcbb","creative_categorical_1_977c2300","creative_categorical_10_43c867fd","creative_categorical_10_65dcab89","creative_categorical_11_43c867fd","creative_categorical_11_65dcab89","creative_categorical_12_2c20d45a","creative_categorical_12_3b9c9e47","creative_categorical_12_546044ce","creative_categorical_12_5a832dd7","creative_categorical_12_5e6c4fa2","creative_categorical_12_80819d2d","creative_categorical_12_80be6600","creative_categorical_12_83dae26d","creative_categorical_12_8f6f5f41","creative_categorical_12_99df4af8","creative_categorical_12_a6d930ab","creative_categorical_12_e49d4663","creative_categorical_12_e7c4004c","creative_categorical_2_1d2fa540","creative_categorical_2_35f28cba","creative_categorical_2_451daa93","creative_categorical_2_50e522c2","creative_categorical_2_51499fde","creative_categorical_2_76d66943","creative_categorical_2_857e02b0","creative_categorical_2_d97f9242","creative_categorical_2_e5892738","creative_categorical_2_eacc48c8","creative_categorical_2_eec28017","creative_categorical_3_095cc02c","creative_categorical_3_11a9f48f","creative_categorical_3_14cfe7e8","creative_categorical_3_28712cad","creative_categorical_3_29c52868","creative_categorical_3_317eb9d9","creative_categorical_3_58878e0e","creative_categorical_3_58fc9493","creative_categorical_3_5f68c5e6","creative_categorical_3_9d5b05ac","creative_categorical_3_a5b257c7","creative_categorical_3_d75eba3c","creative_categorical_4_150d94b7","creative_categorical_4_7f1dcf83","creative_categorical_4_f3b258d1","creative_categorical_5_187ab755","creative_categorical_5_19a8de90","creative_categorical_5_2682bc9d","creative_categorical_5_310dd70a","creative_categorical_5_52ea3f88","creative_categorical_5_654a0207","creative_categorical_5_79ceee49","creative_categorical_5_8119d1b4","creative_categorical_5_cbe10a79","creative_categorical_5_d5635eda","creative_categorical_5_e1f9d2d7","creative_categorical_5_e5ea5549","creative_categorical_7_2b22dd6f","creative_categorical_7_2b235cde","creative_categorical_7_6b5d903f","creative_categorical_7_a7e34545","creative_categorical_7_b98125c8","creative_categorical_7_f1b6690d","creative_categorical_7_ff858f87","creative_categorical_8_40ceda44","creative_categorical_8_5e63aaac","creative_categorical_8_b00371d3","creative_categorical_8_b6910b48","creative_categorical_8_d9d53fe0","creative_categorical_9_43c867fd","creative_categorical_9_65dcab89","gender_f","gender_m","gender_o","has_video_False","has_video_True","creative_width_300.0","creative_width_320.0","creative_width_480.0","creative_width_728.0","creative_width_768.0","creative_width_1024.0","creative_height_50.0","creative_height_90.0","creative_height_250.0","creative_height_320.0","creative_height_480.0","creative_height_768.0","creative_height_1024.0","device_id_type_42080e25","device_id_type_6324b367","device_id_type_c1d12c8e","auction_boolean_0_43c867fd","auction_boolean_0_47980dda","auction_boolean_0_79ceee49","auction_boolean_1_47980dda","auction_boolean_1_79ceee49","auction_boolean_2_43c867fd","auction_boolean_2_65dcab89","action_list_0_IAB22","action_list_0_IAB8-9","action_list_0_IAB20-6","action_list_0_IAB9-30","action_list_0_IAB20","action_list_0_IAB22-2","action_list_1_-6779","action_list_1_","action_list_1_6871","action_list_1_-6454","action_list_1_7195","action_list_1_-7195","action_list_1_-5559","action_list_1_6615","action_list_1_6118","action_list_1_6617","action_list_1_-5579","action_list_1_6119","action_list_1_-6617","action_list_1_-6119","action_list_1_5578","action_list_1_6902","action_list_1_6613","action_list_1_2606","action_list_1_6874","action_list_1_-5577","action_list_1_-6871","action_list_1_5559","action_list_1_6824","action_list_1_6451","action_list_1_7190","action_list_1_-7199","action_list_1_7199","action_list_1_-6903","action_list_1_-6615","action_list_1_-6823","action_list_1_5579","action_list_1_5736","action_list_1_-5736","action_list_1_-7190","action_list_1_-6824","action_list_1_-7033","action_list_1_6614","action_list_1_5577","action_list_1_-6118","action_list_1_6454","action_list_1_-7194","action_list_1_7194","action_list_1_6780","action_list_1_-6780","action_list_1_-6902","action_list_1_-6616","action_list_1_-2606","action_list_1_6823","action_list_1_6616","action_list_1_6779","action_list_1_-6451","action_list_1_-6874","action_list_1_-6614","action_list_1_-5578","action_list_1_-6618","action_list_1_-6613","action_list_1_6903","action_list_1_7033","action_list_1_6618","action_list_2_","action_list_2_7263","action_list_2_6871","action_list_2_-6309","action_list_2_-6905","action_list_2_7262","action_list_2_6224","action_list_2_-5559","action_list_2_6774","action_list_2_6118","action_list_2_-5579","action_list_2_6119","action_list_2_5470","action_list_2_5902","action_list_2_-6220","action_list_2_-6621","action_list_2_-5577","action_list_2_-6867","action_list_2_6867","action_list_2_5559","action_list_2_-7127","action_list_2_7190","action_list_2_6547","action_list_2_6125","action_list_2_-6226","action_list_2_-6823","action_list_2_-7111","action_list_2_6876","action_list_2_-6938","action_list_2_-6125","action_list_2_5471","action_list_2_6219","action_list_2_6454","action_list_2_7127","action_list_2_-6904","action_list_2_-6822","action_list_2_7112","action_list_2_-6218","action_list_2_-6451","action_list_2_-6543","action_list_2_-5578","action_list_2_5605","action_list_2_-6219","action_list_2_6904","action_list_2_6544","action_list_2_2560","action_list_2_-6850","action_list_2_-5605","action_list_2_-7265","action_list_2_-6454","action_list_2_7196","action_list_2_7195","action_list_2_-7195","action_list_2_-6548","action_list_2_-6617","action_list_2_5578","action_list_2_6220","action_list_2_-6871","action_list_2_7143","action_list_2_5603","action_list_2_-6849","action_list_2_6223","action_list_2_-5604","action_list_2_-6770","action_list_2_5576","action_list_2_5577","action_list_2_-7264","action_list_2_-7112","action_list_2_6849","action_list_2_7111","action_list_2_6822","action_list_2_6825","action_list_2_-6616","action_list_2_5604","action_list_2_6226","action_list_2_-6820","action_list_2_6848","action_list_2_6775","action_list_2_-6946","action_list_2_-5469","action_list_2_-6224","action_list_2_-2560","action_list_2_-7263","action_list_2_6929","action_list_2_6615","action_list_2_-6866","action_list_2_7126","action_list_2_6218","action_list_2_6875","action_list_2_-5613","action_list_2_6451","action_list_2_-6615","action_list_2_6543","action_list_2_6800","action_list_2_-6118","action_list_2_6780","action_list_2_-6848","action_list_2_-6547","action_list_2_5469","action_list_2_-5576","action_list_2_-6825","action_list_2_-6223","action_list_2_6866","action_list_2_-6217","action_list_2_-6775","action_list_2_-5470","action_list_2_-6618","action_list_2_-6620","action_list_2_-6929","action_list_2_6850","action_list_2_6938","action_list_2_6865","action_list_2_6548","action_list_2_7265","action_list_2_5613","action_list_2_-6875","action_list_2_6617","action_list_2_-7126","action_list_2_-6119","action_list_2_-6544","action_list_2_-5560","action_list_2_6770","action_list_2_-7262","action_list_2_6820","action_list_2_5579","action_list_2_-5902","action_list_2_-5603","action_list_2_-7190","action_list_2_-6800","action_list_2_6309","action_list_2_-5471","action_list_2_-6780","action_list_2_6823","action_list_2_6946","action_list_2_6616","action_list_2_6621","action_list_2_6217","action_list_2_6620","action_list_2_-7196","action_list_2_-6774","action_list_2_-6876","action_list_2_-7143","action_list_2_7264","action_list_2_6905","action_list_2_5560","action_list_2_-6865","action_list_2_6618","auction_list_0_","auction_list_0_AND18","auction_list_0_IAB19-12","auction_list_0_IAB14-4","auction_list_0_social_networking","auction_list_0_IAB10-1","auction_list_0_IAB9-22","auction_list_0_APL4","auction_list_0_IAB11-2","auction_list_0_news","auction_list_0_IAB10-3","auction_list_0_IAB7-14","auction_list_0_IAB7-30","auction_list_0_business","auction_list_0_IAB20-14","auction_list_0_IAB17-44","auction_list_0_IAB7-17","auction_list_0_IAB7-31","auction_list_0_AND23","auction_list_0_AND8","auction_list_0_IAB19-18","auction_list_0_IAB7-25","auction_list_0_IAB18","auction_list_0_IAB5","auction_list_0_IAB7-41","auction_list_0_AND12","auction_list_0_IAB9-3","auction_list_0_IAB18-1","auction_list_0_IAB20-13","auction_list_0_IAB9-21","auction_list_0_IAB2-4","auction_list_0_IAB7-4","auction_list_0_healthcare_and_fitness","auction_list_0_IAB19-36","auction_list_0_APL17","auction_list_0_IAB7-2","auction_list_0_IAB14-8","auction_list_0_IAB9-8","auction_list_0_navigation","auction_list_0_IAB19-29","auction_list_0_IAB19-8","auction_list_0_IAB20-24","auction_list_0_AND16","auction_list_0_IAB9-12","auction_list_0_IAB7-23","auction_list_0_IAB20-5","auction_list_0_IAB2-8","auction_list_0_IAB14-5","auction_list_0_APL19","auction_list_0_APL16","auction_list_0_IAB19-7","auction_list_0_IAB7-16","auction_list_0_IAB5-14","auction_list_0_IAB19-10","auction_list_0_IAB9-13","auction_list_0_IAB19-14","auction_list_0_IAB17-2","auction_list_0_IAB9-31","auction_list_0_weather","auction_list_0_IAB1","auction_list_0_IAB19-22","auction_list_0_IAB19-11","auction_list_0_IAB15-6","auction_list_0_IAB5-7","auction_list_0_IAB5-8","auction_list_0_APL3","auction_list_0_APL14","auction_list_0_IAB17-12","auction_list_0_APL11","auction_list_0_AND2","auction_list_0_IAB20-16","auction_list_0_APL7","auction_list_0_AND17","auction_list_0_AND11","auction_list_0_IAB20-8","auction_list_0_IAB20-7","auction_list_0_IAB9-7","auction_list_0_IAB7-37","auction_list_0_APL1","auction_list_0_APL10","auction_list_0_IAB17","auction_list_0_AND24","auction_list_0_AND27","auction_list_0_IAB11-4","auction_list_0_IAB20-26","auction_list_0_photography","auction_list_0_IAB1-6","auction_list_0_IAB14-2","auction_list_0_IAB20-25","auction_list_0_APL9","auction_list_0_IAB19-17","auction_list_0_IAB19-3","auction_list_0_IAB10-5","auction_list_0_IAB19-33","auction_list_0_IAB7-38","auction_list_0_IAB15-10","auction_list_0_IAB7-33","auction_list_0_APL22","auction_list_0_IAB20-23","auction_list_0_IAB12-1","auction_list_0_IAB19-19","auction_list_0_IAB9-23","auction_list_0_IAB19-27","auction_list_0_IAB3-8","auction_list_0_utilities","auction_list_0_IAB9-20","auction_list_0_IAB9-5","auction_list_0_IAB9-11","auction_list_0_IAB7-43","auction_list_0_education","auction_list_0_AND1","auction_list_0_IAB19-16","auction_list_0_IAB2-17","auction_list_0_IAB9-25","auction_list_0_IAB9-9","auction_list_0_IAB7-10","auction_list_0_IAB6-4","auction_list_0_IAB20-4","auction_list_0_IAB7-8","auction_list_0_IAB10","auction_list_0_IAB8-1","auction_list_0_IAB20-27","auction_list_0_IAB20-6","auction_list_0_IAB20-12","auction_list_0_IAB24","auction_list_0_AND6","auction_list_0_AND21","auction_list_0_AND4","auction_list_0_IAB20-2","auction_list_0_IAB19","auction_list_0_IAB7-7","auction_list_0_IAB7-27","auction_list_0_IAB9-28","auction_list_0_IAB7-29","auction_list_0_IAB16-6","auction_list_0_IAB7-19","auction_list_0_IAB17-9","auction_list_0_APL8","auction_list_0_IAB5-4","auction_list_0_IAB17-26","auction_list_0_APL18","auction_list_0_IAB5-12","auction_list_0_IAB6-7","auction_list_0_IAB22","auction_list_0_IAB2","auction_list_0_IAB16-4","auction_list_0_IAB9-6","auction_list_0_APL21","auction_list_0_IAB7-12","auction_list_0_IAB13-7","auction_list_0_games","auction_list_0_IAB23-4","auction_list_0_IAB17-13","auction_list_0_IAB14-6","auction_list_0_IAB20-22","auction_list_0_IAB6-1","auction_list_0_IAB4","auction_list_0_IAB20-17","auction_list_0_IAB14-7","auction_list_0_IAB20-9","auction_list_0_IAB12","auction_list_0_IAB9-14","auction_list_0_IAB19-2","auction_list_0_IAB20-19","auction_list_0_AND19","auction_list_0_IAB17-27","auction_list_0_APL6","auction_list_0_IAB20","auction_list_0_AND15","auction_list_0_IAB7-20","auction_list_0_IAB19-1","auction_list_0_IAB21-3","auction_list_0_IAB5-6","auction_list_0_IAB15","auction_list_0_IAB7-34","auction_list_0_IAB23","auction_list_0_IAB19-23","auction_list_0_IAB6-5","auction_list_0_IAB11","auction_list_0_IAB3-3","auction_list_0_IAB20-21","auction_list_0_AND22","auction_list_0_IAB19-30","auction_list_0_entertainment","auction_list_0_IAB7-28","auction_list_0_IAB6-6","auction_list_0_IAB1-7","auction_list_0_IAB14-3","auction_list_0_IAB7-36","auction_list_0_IAB20-20","auction_list_0_IAB3-5","auction_list_0_IAB14","auction_list_0_IAB7","auction_list_0_IAB5-15","auction_list_0_IAB6-2","auction_list_0_IAB5-5","auction_list_0_IAB17-1","auction_list_0_IAB14-1","auction_list_0_IAB19-28","auction_list_0_IAB19-34","auction_list_0_IAB9-1","auction_list_0_APL20","auction_list_0_IAB9-17","auction_list_0_IAB10-9","auction_list_0_IAB9-19","auction_list_0_IAB2-12","auction_list_0_IAB10-2","auction_list_0_IAB7-11","auction_list_0_IAB7-9","auction_list_0_IAB19-24","auction_list_0_IAB8","auction_list_0_IAB19-13","auction_list_0_AND3","auction_list_0_IAB7-3","auction_list_0_IAB9-18","auction_list_0_AND5","auction_list_0_IAB19-5","auction_list_0_sports","auction_list_0_APL13","auction_list_0_IAB12-3","auction_list_0_IAB7-1","auction_list_0_AND9","auction_list_0_lifestyle","auction_list_0_IAB20-15","auction_list_0_IAB18-3","auction_list_0_IAB7-44","auction_list_0_IAB7-35","auction_list_0_AND7","auction_list_0_IAB5-3","auction_list_0_IAB5-11","auction_list_0_IAB6-3","auction_list_0_medical","auction_list_0_IAB20-3","auction_list_0_IAB9-30","auction_list_0_AND25","auction_list_0_IAB7-5","auction_list_0_AND26","auction_list_0_IAB-5","auction_list_0_IAB5-13","auction_list_0_IAB7-15","auction_list_0_travel","auction_list_0_IAB1-1","auction_list_0_IAB9","auction_list_0_IAB18-5","auction_list_0_IAB7-40","auction_list_0_IAB9-29","auction_list_0_APL15","auction_list_0_IAB12-2","auction_list_0_IAB19-6","auction_list_0_IAB19-35","auction_list_0_IAB19-26","auction_list_0_IAB19-4","auction_list_0_IAB4-4","auction_list_0_APL2","auction_list_0_APL5","auction_list_0_IAB1-5","auction_list_0_IAB7-21","auction_list_0_IAB7-22","auction_list_0_IAB7-42","auction_list_0_IAB21","auction_list_0_IAB16","auction_list_0_IAB1-4","auction_list_0_IAB2-19","auction_list_0_IAB9-10","auction_list_0_IAB9-16","auction_list_0_IAB8-6","auction_list_0_IAB1-2","auction_list_0_IAB13","auction_list_0_IAB7-24","auction_list_0_IAB3","auction_list_0_productivity","auction_list_0_APL12","auction_list_0_IAB5-9","auction_list_0_finance","auction_list_0_IAB18-2","auction_list_0_IAB6","auction_list_0_books","auction_list_0_IAB17-39","auction_list_0_IAB7-45","auction_list_0_IAB7-18","auction_list_0_IAB9-24","auction_list_0_IAB1-3","auction_list_0_music","auction_list_0_IAB7-13","auction_list_0_IAB2-14","auction_list_0_IAB9-2","auction_list_0_IAB7-26","auction_list_0_IAB19-31","auction_list_0_IAB4-1","auction_list_0_IAB6-9","auction_list_0_IAB10-7","auction_list_0_IAB19-32","auction_list_0_IAB23-5","auction_list_0_IAB19-25","auction_list_0_IAB17-14","auction_list_0_IAB19-15","auction_list_0_IAB7-32","auction_list_0_IAB9-27","auction_list_0_IAB5-10","auction_list_0_reference","auction_list_0_IAB20-10","auction_list_0_IAB10-4","auction_list_0_IAB16-2","auction_list_0_IAB7-39","auction_list_0_AND13","auction_list_0_IAB5-1","auction_list_0_IAB9-4","auction_list_0_IAB9-26","auction_list_0_IAB4-5","auction_list_0_IAB7-6","auction_list_0_AND20","auction_list_0_IAB20-1","auction_list_0_IAB19-21","auction_list_0_IAB5-2","auction_list_0_AND14","auction_list_0_IAB19-20","auction_list_0_AND10","auction_list_0_IAB20-18","auction_list_0_IAB17-35","auction_list_0_IAB20-11","auction_list_0_IAB9-15","action_categorical_1_49bef539","action_categorical_7_afc0ea45","creative_categorical_12_7ae53064","creative_categorical_12_dd370958","creative_categorical_7_8bc11a1e"]



# Load only the column names from the training data from 15 to 21


#print(columnas)

#columns = pd.read_parquet(r"C:\Users\fpereira\OneDrive - BYMA\Documentos\GitHub\Jaggle-Competition\train_data15_False_True.parquet", columns=None).select_dtypes(include='number').columns

path_model = r"C:\Users\fpereira\OneDrive - BYMA\Documentos\GitHub\Jaggle-Competition\xgb_final_model_2.json"
#load model
model = xgb.Booster()
model.load_model(path_model)

# Load the test data
parquet_path =rf"C:\Users\fpereira\OneDrive - BYMA\Documentos\GitHub\Jaggle-Competition\train_data22_False_True.parquet"
cols1 = pd.read_parquet(parquet_path, columns=None).columns

print(1)
columns1=[col for col in columnas if col in cols1] + ['id']
print(2)
try:
    eval_data = pd.read_parquet(parquet_path, columns=columns1)
except Exception as e:
    print("Error al cargar el archivo:",e)

print(3)
#sampleo
#eval_data = eval_data.sample(frac=1/15)
train_data = eval_data.drop(columns=['id'])
train_data = train_data.select_dtypes(include='number')
print(len(train_data.columns))
print(len(columnas))
#eval_data = eval_data.apply(pd.to_numeric, errors='coerce')
#train_data = eval_data.select_dtypes(include='number')
for col in columnas:
    if col not in train_data.columns:
        train_data[col] = 0
print(len(train_data.columns))
train_data = train_data.select_dtypes(include='number')
train_data = train_data[columnas]
print(len(train_data.columns))

# escribo columnas en un txt
with open(r"C:\Users\fpereira\OneDrive - BYMA\Documentos\GitHub\Jaggle-Competition\columnas.txt", "w") as output:
    output.write(str(list(train_data.columns)))

#escribo columnas con diferencia 
with open(r"C:\Users\fpereira\OneDrive - BYMA\Documentos\GitHub\Jaggle-Competition\columnas_diff.txt", "w") as output:
    output.write(str([col for col in columnas if col not in train_data.columns]))



# Predict on the evaluation set
try:
    y_preds = model.predict(xgb.DMatrix(train_data),validate_features=True)


    # Make the submission file
    submission_df = pd.DataFrame({"id": eval_data["id"], "Label": y_preds})
    submission_df["id"] = submission_df["id"].astype(int)
    submission_df.to_csv("xgb_model.csv", sep=",", index=False)
except Exception as e:
    # guard error

    with open(r"C:\Users\fpereira\OneDrive - BYMA\Documentos\GitHub\Jaggle-Competition\error.txt", "w") as output:
        output.write(str(e))

    print("Error al predecir:",e)